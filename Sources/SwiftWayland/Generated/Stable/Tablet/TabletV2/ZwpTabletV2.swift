import Foundation

/// Graphics Tablet Device
/// 
/// The zwp_tablet_v2 interface represents one graphics tablet device. The
/// tablet interface itself does not generate events; all events are
/// generated by zwp_tablet_tool_v2 objects when in proximity above a tablet.
/// A tablet has a number of static characteristics, e.g. device name and
/// pid/vid. These capabilities are sent in an event sequence after the
/// zwp_tablet_seat_v2.tablet_added event. This initial event sequence is
/// terminated by a zwp_tablet_v2.done event.
public final class ZwpTabletV2: WlProxyBase, WlProxy, WlInterface {
    public static let name: String = "zwp_tablet_v2"
    public var onEvent: (Event) -> Void = { _ in }

    /// Destroy The Tablet Object
    /// 
    /// This destroys the client's resource for this tablet object.
    public consuming func destroy() throws(WaylandProxyError) {
        guard self._state == WaylandProxyState.alive else { throw WaylandProxyError.destroyed }
        let message = Message(objectId: self.id, opcode: 0, contents: [])
        connection.send(message: message)
        self._state = .dropped
        connection.removeObject(id: self.id)
    }
    
    deinit {
        try! self.destroy()
    }
    
    /// Bus Type 
    /// 
    /// Describes the bus types this tablet is connected to.
    /// 
    /// Available since version 2
    public enum Bustype: UInt32, WlEnum {
        /// Usb
        case usb = 3
        
        /// Bluetooth
        case bluetooth = 5
        
        /// Virtual
        case virtual = 6
        
        /// Serial
        case serial = 17
        
        /// I2C
        case i2c = 24
    }
    
    public enum Event: WlEventEnum {
        /// Tablet Device Name
        /// 
        /// A descriptive name for the tablet device.
        /// If the device has no descriptive name, this event is not sent.
        /// This event is sent in the initial burst of events before the
        /// zwp_tablet_v2.done event.
        /// 
        /// - Parameters:
        ///   - Name: the device name
        case name(name: String)
        
        /// Tablet Device Vendor/Product Id
        /// 
        /// The vendor and product IDs for the tablet device.
        /// The interpretation of the id depends on the zwp_tablet_v2.bustype.
        /// Prior to version v2 of this protocol, the id was implied to be a USB
        /// vendor and product ID. If no zwp_tablet_v2.bustype is sent, the ID
        /// is to be interpreted as USB vendor and product ID.
        /// If the device has no vendor/product ID, this event is not sent.
        /// This can happen for virtual devices or non-USB devices, for instance.
        /// This event is sent in the initial burst of events before the
        /// zwp_tablet_v2.done event.
        /// 
        /// - Parameters:
        ///   - Vid: vendor id
        ///   - Pid: product id
        case id(vid: UInt32, pid: UInt32)
        
        /// Path To The Device
        /// 
        /// A system-specific device path that indicates which device is behind
        /// this zwp_tablet_v2. This information may be used to gather additional
        /// information about the device, e.g. through libwacom.
        /// A device may have more than one device path. If so, multiple
        /// zwp_tablet_v2.path events are sent. A device may be emulated and not
        /// have a device path, and in that case this event will not be sent.
        /// The format of the path is unspecified, it may be a device node, a
        /// sysfs path, or some other identifier. It is up to the client to
        /// identify the string provided.
        /// This event is sent in the initial burst of events before the
        /// zwp_tablet_v2.done event.
        /// 
        /// - Parameters:
        ///   - Path: path to local device
        case path(path: String)
        
        /// Tablet Description Events Sequence Complete
        /// 
        /// This event is sent immediately to signal the end of the initial
        /// burst of descriptive events. A client may consider the static
        /// description of the tablet to be complete and finalize initialization
        /// of the tablet.
        case done
        
        /// Tablet Removed Event
        /// 
        /// Sent when the tablet has been removed from the system. When a tablet
        /// is removed, some tools may be removed.
        /// When this event is received, the client must zwp_tablet_v2.destroy
        /// the object.
        case removed
        
        /// Tablet Device Bus Type
        /// 
        /// The bustype argument is one of the BUS_ defines in the Linux kernel's
        /// linux/input.h
        /// If the device has no known bustype or the bustype cannot be
        /// queried, this event is not sent.
        /// This event is sent in the initial burst of events before the
        /// zwp_tablet_v2.done event.
        /// 
        /// - Parameters:
        ///   - Bustype: bus type
        /// 
        /// Available since version 2
        case bustype(bustype: UInt32)
    
        public static func decode(message: Message, connection: Connection, fdSource: BufferedSocket, version: UInt32) -> Self {
            var r = ArgumentParser(data: message.arguments, fdSource: fdSource)
            switch message.opcode {
            case 0:
                return Self.name(name: r.readString())
            case 1:
                return Self.id(vid: r.readUInt(), pid: r.readUInt())
            case 2:
                return Self.path(path: r.readString())
            case 3:
                return Self.done
            case 4:
                return Self.removed
            case 5:
                return Self.bustype(bustype: r.readUInt())
            default:
                fatalError("Unknown message")
            }
        }
    }
}
